<?xml version="1.0"?>

<robot name="nelen" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- XACRO parameters-->
    <xacro:arg name="simulation" default="false"/>
    <xacro:arg name="fixed" default="true"/>
    <xacro:arg name="name" default="base"/>

    <!-- Arm parameterization -->
    <xacro:property name="base_x" value= "-0.024844"/>
    <xacro:property name="base_y" value= "-0.012773"/>
    <xacro:property name="base_z" value= "0.34999"/>
    <xacro:property name="base_mass" value= "15.652"/>
    <xacro:property name="base_inertia_xx" value="0.077426"/>
    <xacro:property name="base_inertia_xy" value= "1.6502E-15"/>
    <xacro:property name="base_inertia_xz" value= "-3.9864E-16"/>
    <xacro:property name="base_inertia_yy" value= "0.08833"/>
    <xacro:property name="base_inertia_yz" value= "9.4391E-06"/>
    <xacro:property name="base_inertia_zz" value= "0.07706"/>


    <!-- Attach the robot to the world link if requested -->
    <xacro:if value="$(arg fixed)">
        <gazebo>
            <joint name="world_joint" type="fixed">
                <parent>$(arg name)</parent>
                <child>world</child>
            </joint>
        </gazebo>
    </xacro:if>

    <!-- Base link -->
    <link name="$(arg name)">
        <visual>
            <geometry>
                <mesh filename="package://nelen_description/meshes/base_corrected.dae" />
            </geometry>
            <material name="">
                <color rgba="0.75294 0.75294 0.75294 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/base_corrected.dae" />
            </geometry>
        </collision>
    </link>

    <!-- Fixed joint to add dummy inertia link -->
    <joint name="$(arg name)_to_$(arg name)_inertia" type="fixed">
        <parent link="$(arg name)"/>
        <child link="$(arg name)_inertia"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>

    <!-- Dummy inertia link, because KDL cannot have inertia on the base link -->
    <link name="$(arg name)_inertia">
        <inertial>
            <origin xyz="${base_x} ${base_y} ${base_z}" rpy="0 0 0"/>
            <mass value="${base_mass}"/>
            <inertia ixx="${base_inertia_xx}" ixy="${base_inertia_xy}" ixz="${base_inertia_xz}" iyy="${base_inertia_yy}" iyz="${base_inertia_yz}" izz="${base_inertia_zz}"/>
        </inertial>
    </link>

    <!-- Link - Humero -->
    <link name="humero">
        <inertial>
            <origin xyz="1.0851E-08 0.048114 0.14266" rpy="0 0 0" />
            <mass value="5" />
            <inertia ixx="0.019084" ixy="-1.4804E-10" ixz="-2.2963E-09" iyy="0.020036" iyz="-0.00043182" izz="0.0013447" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/humero_corrected.dae" />
            </geometry>
            <material name="">
                <color rgba="0.75294 0.75294 0.75294 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/humero_corrected.dae" />
            </geometry>
        </collision>
    </link>

    <!-- Joint - Hombro -->
    <joint name="hombro" type="revolute">
        <origin xyz="0 0 0.262" rpy="0 0 0" />
        <parent link="$(arg name)" />
        <child link="humero" />
        <axis xyz="0 0 1" />
        <limit lower="-1.57" upper="1.57" effort="45" velocity="8" />
    </joint>

    <!-- Link - RC -->
    <link name="rc">
        <inertial>
            <origin xyz="6.9227E-07 0.15158 0.13901" rpy="0 0 0" />
            <mass value="15" />
            <inertia ixx="0.011379" ixy="1.7481E-08" ixz="-5.0618E-08" iyy="0.007139" iyz="-0.0017743" izz="0.0062172" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/rc_corrected.dae" />
            </geometry>
            <material name="">
                <color rgba="0.75294 0.75294 0.75294 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/rc_corrected.dae" />
            </geometry>
        </collision>
    </link>

    <!-- Joint - Codo -->
    <joint name="codo" type="revolute">
        <origin xyz="0 -0.33 0.052" rpy="0 0 0" />
        <parent link="humero" />
        <child link="rc" />
        <axis xyz="0 0 1" />
        <limit lower="-2.61" upper="2.61" effort="35" velocity="8" />
    </joint>

    <!-- Link - Zeta -->
    <link name="zeta">
        <inertial>
            <origin xyz="-0.011881 0.12518 -0.016578" rpy="0 0 0" />
            <mass value="2" />
            <inertia ixx="0.0028275" ixy="3.4325E-06" ixz="2.9995E-10" iyy="0.00010967" iyz="9.9633E-12" izz="0.0028174" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/z_corrected.dae" />
            </geometry>
            <material name="">
                <color rgba="0.75294 0.75294 0.75294 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://nelen_description/meshes/z_corrected.dae" />
            </geometry>
        </collision>
    </link>

    <!-- Joint - Pris -->
    <joint name="pris" type="prismatic">
        <origin xyz="0 -0.3534 -0.049" rpy="0 0 0" />
        <parent link="rc" />
        <child link="zeta" />
        <axis xyz="0 0 1" />
        <limit lower="-0.268" upper="0" effort="70" velocity="5" />
    </joint>



    <!-- Simulation -->
    <xacro:if value="$(arg simulation)">
        <!-- Gazebo plugin -->
        <transmission name="trans_hombro">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="hombro">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
            </joint>
            <actuator name="hombro_motor">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
                <mechanicalReduction>7</mechanicalReduction>
            </actuator>
        </transmission>

        <transmission name="trans_codo">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="codo">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
            </joint>
            <actuator name="codo_motor">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
                <mechanicalReduction>7</mechanicalReduction>
            </actuator>
        </transmission>
        <transmission name="trans_pris">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="pris">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
            </joint>
            <actuator name="pris_motor">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>                <!-- aqui poner interfaz con odrive -->
                <mechanicalReduction>392.5</mechanicalReduction>
            </actuator>
        </transmission>
        <gazebo>
            <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
                <robotNamespace>nelen</robotNamespace>
            </plugin>
        </gazebo>


    </xacro:if>    <!-- simulation -->
</robot>